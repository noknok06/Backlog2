{% extends 'base.html' %}

{% block title %}Join Project{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div class="card-header bg-dark text-light">
            <h3 class="mb-0">Join Project Form</h3>
        </div>
        <div class="card-body">
            <form method="post" id="join-project-form">
                {% csrf_token %}
                <div class="form-group">
                    <label for="project-search">Search Project:</label>
                    <input type="text" id="project-search" class="form-control" placeholder="Enter project name">
                </div>
                
                <!-- プロジェクトリストを表示する領域 -->
                <div id="project-results" class="mt-3"></div>
            </form>
        </div>
    </div>
</div>

<script>
// プロジェクト検索のイベントリスナーを設定
document.getElementById('project-search').addEventListener('input', function() {
    var query = this.value;
    if (query.length > 0) {  // 文字が3つ以上入力されたら検索を開始
        fetch('/project/search/?q=' + query)
            .then(response => response.json())
            .then(data => {
                var resultDiv = document.getElementById('project-results');
                resultDiv.innerHTML = '';  // リストをクリア
                data.forEach(function(project) {
                    var projectDiv = document.createElement('div');
                    projectDiv.classList.add('project-item');
                    projectDiv.innerHTML = `
                        <div class="card mb-2">
                            <div class="card-body">
                                <strong>${project.name}</strong>
                                <button class="btn btn-sm btn-success float-right select-project-btn" data-project-id="${project.id}">Select</button>
                            </div>
                        </div>`;
                    
                    // 選択ボタンにイベントリスナーを追加
                    projectDiv.querySelector('.select-project-btn').addEventListener('click', function() {
                        document.getElementById('id_project').value = project.id;
                        alert('Selected project: ' + project.name);
                    });

                    resultDiv.appendChild(projectDiv);
                });
            });
    }
});
</script>
{% endblock %}
